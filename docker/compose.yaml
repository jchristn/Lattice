services:
  server:
    image: jchristn77/lattice:${SERVER_IMAGE_TAG:-v0.1.0}
    container_name: lattice-server
    restart: unless-stopped
    ports:
      - "8000:8000"
    volumes:
      - ./server/lattice.json:/app/lattice.json:ro
      - ./server/logs:/app/logs
      - ./server/data:/app/data
    command: ["lattice.json"]

  dashboard:
    image: jchristn77/lattice-ui:${DASHBOARD_IMAGE_TAG:-v0.1.0}
    container_name: lattice-dashboard
    restart: unless-stopped
    ports:
      - "3000:80"
    environment:
      - LATTICE_SERVER_URL=${LATTICE_SERVER_URL:-http://lattice-server:8000}
    command: ["/bin/sh", "-c", "echo \"window.__LATTICE_CONFIG__={serverUrl:'$$LATTICE_SERVER_URL'};\" > /usr/share/nginx/html/config.js && nginx -g 'daemon off;'"]
    depends_on:
      - server
